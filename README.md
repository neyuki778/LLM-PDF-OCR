# LLM-PDF-OCR

åŸºäº Go + å¤šæ¨¡æ€LLM çš„é«˜æ•ˆã€ç»æµå¹¶ä¸”å‡†ç¡® PDF è½¬ Markdown æœåŠ¡ï¼Œé€šè¿‡åˆ†ç‰‡å¹¶å‘å¤„ç†çªç ´å¤§æ–‡ä»¶é™åˆ¶ã€‚

## ğŸ’¡ é¡¹ç›®åˆè¡·

### ä¸ºä»€ä¹ˆåšè¿™ä¸ªé¡¹ç›®ï¼Ÿ

1. **Markdown æ¯” PDF æ›´é€‚åˆé˜…è¯»å’Œå¤„ç†**
   - å¯¹äººç±»ï¼šæ”¯æŒå…¨æ–‡æ£€ç´¢ã€ç‰ˆæœ¬æ§åˆ¶ã€ç›´æ¥ç¼–è¾‘
   - å¯¹ LLMï¼šçº¯æ–‡æœ¬æ ¼å¼å‡å°‘ token æ¶ˆè€—ï¼Œä¸Šä¸‹æ–‡ç†è§£æ›´å‡†ç¡®

2. **LLMè‡ªèº«çš„å±€é™æ€§**
   - Max Output Tokenå’ŒMax Input Tokenä¸¥é‡ä¸å¯¹ç­‰ (ä»¥gemini-3-flash-previewä¸ºä¾‹: æœ€å¤§è¾“å…¥Token 1m, è¾“å‡ºåªæœ‰64k)
   - å¤§éƒ¨åˆ†æ¨¡å‹ä»¥é˜¶æ¢¯å¼è®¡è´¹, æˆæœ¬éšç€(è¾“å…¥/è¾“å‡º)Tokenæ•°å¢é•¿è€Œå¤§å¹…å¢åŠ 

3. **ä¸Šä¸‹æ–‡æ— å…³çš„åˆ†ç‰‡ç­–ç•¥æ›´ç»æµ**
   - OCR ä»»åŠ¡å¤©ç„¶é€‚åˆåˆ†ç‰‡ï¼šæ¯é¡µè¯†åˆ«äº’ä¸ä¾èµ–
   - åˆ†ç‰‡åå•è¯·æ±‚ token æ¶ˆè€—æ›´å°‘ï¼Œæˆæœ¬æ›´ä½
   - å¤±è´¥æ—¶åªéœ€é‡è¯•å•ä¸ªåˆ†ç‰‡ï¼Œä¸å¿…é‡è·‘å…¨æ–‡

4. **å……åˆ†åˆ©ç”¨å¹¶å‘æå‡æ•ˆç‡**
   - 100 é¡µ PDFï¼šä¸²è¡Œéœ€ 100 ç§’ï¼Œ5 worker å¹¶å‘ä»…éœ€ 20 ç§’ (ç†è®ºä¸Š)
   - Worker Pool æ¨¡å¼å……åˆ†æ¦¨å– API é…é¢å’Œå¹¶è¡Œç¨‹åº¦ (å¤šAPIæ”¯æŒæ­£åœ¨è·¯ä¸Š)

## ğŸ— ç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒæµç¨‹

```
ç”¨æˆ·ä¸Šä¼  PDF
    â†“
åˆ†ç‰‡å¤„ç†ï¼ˆ5é¡µ/ç‰‡ï¼‰
    â†“
ä»»åŠ¡é˜Ÿåˆ— (buffered channel)
    â†“
Worker Pool (5 workers)
    â”œâ”€ Worker 1 â†’ Gemini API â†’ åˆ†ç‰‡ç»“æœ1
    â”œâ”€ Worker 2 â†’ Gemini API â†’ åˆ†ç‰‡ç»“æœ2
    â””â”€ ...
    â†“
èšåˆå™¨ï¼ˆæŒ‰é¡µç æ’åºï¼‰
    â†“
è¾“å‡º Markdown æ–‡ä»¶
```

### æŠ€æœ¯æ ˆ

-   **Go**ï¼šåŸç”Ÿå¹¶å‘æ”¯æŒï¼Œé«˜æ•ˆçš„ goroutine å’Œ channel
-   **Gemini 3 Flash**ï¼šç›´æ¥æ”¯æŒ PDF ä¸Šä¼ ï¼Œå¤„ç†é€Ÿåº¦å¿«ã€æˆæœ¬ä½
-   **pdfcpu**ï¼šçº¯ Go å®ç°çš„ PDF å¤„ç†åº“ï¼Œæ— éœ€ C ä¾èµ–

### å…³é”®è®¾è®¡

#### ä¸¤å±‚ä»»åŠ¡æ¨¡å‹

```go
ParentTask (ç”¨æˆ·è§†è§’)
  â”œâ”€ ID: task_abc
  â”œâ”€ çŠ¶æ€: pending â†’ processing â†’ completed
  â”œâ”€ è¿›åº¦: 15/20 (å·²å®Œæˆ/æ€»åˆ†ç‰‡æ•°)
  â””â”€ ç»“æœ: output/task_abc.md

SubTask (å†…éƒ¨å®ç°)
  â”œâ”€ å¯¹åº” PDF çš„ä¸€ä¸ªåˆ†ç‰‡ï¼ˆå¦‚ç¬¬1-5é¡µï¼‰
  â”œâ”€ å®Œå…¨å¹¶å‘æ‰§è¡Œï¼Œæ— é¡ºåºä¾èµ–
  â””â”€ èšåˆæ—¶æŒ‰é¡µç æ’åº
```

#### Worker Pool å¹¶å‘æ§åˆ¶ (ç›®å‰)

- **å›ºå®š worker æ•°é‡**ï¼š5 ä¸ª goroutine å¹¶å‘å¤„ç†
- **æœ‰ç•Œä»»åŠ¡é˜Ÿåˆ—**ï¼šå®¹é‡ 100ï¼Œé˜²æ­¢å†…å­˜çˆ†ç‚¸
- **Rate Limiter**ï¼šç²¾ç¡®æ§åˆ¶ API QPMï¼Œé¿å…è§¦å‘é™æµ
- **ä¼˜é›…é‡è¯•**ï¼šå•ç‰‡å¤±è´¥æœ€å¤šé‡è¯• 3 æ¬¡ï¼ŒæŒ‡æ•°é€€é¿

#### é”™è¯¯å¤„ç†ç­–ç•¥

- **éƒ¨åˆ†å¤±è´¥å®¹å¿**ï¼šæŸä¸ªåˆ†ç‰‡å¤±è´¥ 3 æ¬¡åè·³è¿‡ï¼Œç”¨é”™è¯¯ä¿¡æ¯å ä½
- **ç»“æœå®Œæ•´æ€§ä¼˜å…ˆ**ï¼šè¿”å›ä¸å®Œæ•´ä½†å¯ç”¨çš„ Markdownï¼ˆæ ‡æ³¨ç¼ºå¤±é¡µç ï¼‰
- **å®æ—¶è¿›åº¦åé¦ˆ**ï¼š`GET /tasks/{id}` è¿”å› `completed: 15, failed: 2, total: 20`

## ğŸ“‚ é¡¹ç›®ç»“æ„

```bash
.
â”œâ”€â”€ cmd/
â”‚   â”œâ”€â”€ ocr-demo/           # PDF è½¬ Markdown å‘½ä»¤è¡Œå·¥å…·
â”‚   â”œâ”€â”€ gemini-demo/        # Gemini API åŠŸèƒ½æ¼”ç¤º
â”‚   â”œâ”€â”€ mineru-demo/        # MinerU é›†æˆç¤ºä¾‹
â”‚   â”œâ”€â”€ pdf-demo/           # PDF åˆ†ç‰‡æ¼”ç¤º
â”‚   â””â”€â”€ server/             # HTTP æœåŠ¡å…¥å£
â”œâ”€â”€ web/                    # å‰ç«¯ç•Œé¢ (TypeScript)
â”‚   â”œâ”€â”€ index.html          # å•é¡µé¢å…¥å£
â”‚   â”œâ”€â”€ style.css           # Apple é£æ ¼æ ·å¼
â”‚   â”œâ”€â”€ src/main.ts         # TypeScript æºç 
â”‚   â””â”€â”€ dist/main.js        # ç¼–è¯‘è¾“å‡º
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ api/                # HTTP API å±‚ (Gin)
â”‚   â”‚   â”œâ”€â”€ server.go       # Server: Gin å¼•æ“åˆå§‹åŒ–ã€è·¯ç”±æ³¨å†Œ
â”‚   â”‚   â””â”€â”€ handlers.go     # HTTP handlers: createTask, getTask, getResult
â”‚   â”œâ”€â”€ task/               # ä»»åŠ¡ç®¡ç† (TaskManager/ParentTask/SubTask)
â”‚   â”‚   â”œâ”€â”€ manager.go      # ä»»åŠ¡è°ƒåº¦å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†
â”‚   â”‚   â”œâ”€â”€ parent.go       # çˆ¶ä»»åŠ¡èšåˆé€»è¾‘
â”‚   â”‚   â””â”€â”€ types.go        # ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ worker/             # Worker Pool å®ç°
â”‚       â”œâ”€â”€ pool.go         # å¹¶å‘ä»»åŠ¡å¤„ç†
â”‚       â””â”€â”€ types.go        # Worker ç±»å‹å®šä¹‰
â”œâ”€â”€ pkg/
â”‚   â”œâ”€â”€ pdf/                # PDF åˆ†ç‰‡å·¥å…·
â”‚   â”œâ”€â”€ LLM/
â”‚   â”‚   â”œâ”€â”€ gemini/         # Gemini SDK å°è£…
â”‚   â”‚   â””â”€â”€ MinerU/         # MinerU å®¢æˆ·ç«¯å®ç°
â”‚   â””â”€â”€ result/             # ç»“æœå¤„ç†å·¥å…·
â””â”€â”€ output/                 # Markdown è¾“å‡ºç›®å½•
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒé…ç½®

æ”¯æŒ `.env` æˆ–æ‰‹åŠ¨å¯¼å‡ºç¯å¢ƒå˜é‡ï¼ŒæœåŠ¡å¯åŠ¨æ—¶ä¼šè¯»å–ä»¥ä¸‹é…ç½®ï¼š
```bash
GEMINI_API_KEY=your_api_key_here
LLM_PROVIDER=gemini
GEMINI_MODEL=gemini-3-flash-preview

# MinerUï¼ˆä»…åœ¨ LLM_PROVIDER=mineru æ—¶éœ€è¦ï¼‰
PublicURL=your_domain
MINERU_TOKEN=your_token_here
MINERU_BASE_URL=https://mineru.net
MINERU_MODEL_VERSION=vlm
```

### è¿è¡Œç¤ºä¾‹

```bash
# å¯åŠ¨æœåŠ¡ï¼ˆå« Web ç•Œé¢ï¼‰(ç¡®ä¿æœåŠ¡å™¨ä¸Šå·²ç»å®‰è£…äº†golang)
go run ./cmd/server/main.go
# è®¿é—® http://localhost:8080

# å¤„ç† PDF æ–‡ä»¶ï¼ˆå‘½ä»¤è¡Œæ¨¡å¼ï¼‰
go run ./cmd/ocr-demo/main.go ./path/to/your.pdf
# è¾“å‡ºï¼š./output/{task_id}/result.md
```

## ğŸ¯ å¼€å‘è·¯çº¿å›¾

- [x] **Phase 1**: åŸºç¡€ PDF å¤„ç†å’Œ Gemini API é›†æˆ
- [x] **Phase 2**: PDF åˆ†ç‰‡åŠŸèƒ½
- [x] **Phase 3**: Worker Pool å¹¶å‘è°ƒåº¦ + TaskManager
- [x] **Phase 4**: HTTP API æœåŠ¡ + Web å‰ç«¯
- [ ] **Phase 5**: åŠ å…¥Rediså®ç°å†…å­˜ç®¡ç†
- [ ] **Phase 6**: æ”¯æŒå¤šapiè½®è¯¢, è¿›ä¸€æ­¥æé«˜å¹¶å‘ç¨‹åº¦å’Œå¯ç”¨æ€§

## ğŸŒ HTTP API

### ç«¯ç‚¹

```
POST   /api/tasks          # ä¸Šä¼  PDFï¼Œåˆ›å»ºä»»åŠ¡ â†’ è¿”å› task_id
GET    /api/tasks/:id      # æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€å’Œè¿›åº¦
GET    /api/tasks/:id/result  # è·å– Markdown ç»“æœ (JSON æ ¼å¼)
DELETE /api/tasks/:id      # åˆ é™¤ä»»åŠ¡ (å¾…å®ç°)
```

### ä½¿ç”¨ç¤ºä¾‹

```bash
# ä¸Šä¼  PDF
curl -X POST -F "file=@path/to/file.pdf" http://localhost:8080/api/tasks

# æŸ¥è¯¢çŠ¶æ€
curl http://localhost:8080/api/tasks/{task_id}

# è·å–ç»“æœ
curl http://localhost:8080/api/tasks/{task_id}/result
```

## ğŸ“Š æ€§èƒ½ä¼˜åŠ¿ (è®¡åˆ’ä¸­)

*æµ‹è¯•ç¯å¢ƒï¼šGemini 2.5 Flashï¼Œå¹³å‡å•é¡µå¤„ç† 1 ç§’*

## ğŸ”§ æŠ€æœ¯äº®ç‚¹

- **é›¶ä¾èµ–éƒ¨ç½²**ï¼šçº¯ Go å®ç°ï¼Œç¼–è¯‘ä¸ºå•ä¸€äºŒè¿›åˆ¶æ–‡ä»¶
- **å†…å­˜å®‰å…¨**ï¼šæµå¼å¤„ç† PDFï¼Œé¿å…å¤§æ–‡ä»¶ä¸€æ¬¡æ€§åŠ è½½
- **å¯è§‚æµ‹æ€§**ï¼šå®æ—¶ä»»åŠ¡è¿›åº¦ã€è¯¦ç»†é”™è¯¯æ—¥å¿—
- **å¼¹æ€§è®¾è®¡**ï¼šéƒ¨åˆ†å¤±è´¥ä¸é˜»å¡æ•´ä½“ç»“æœè¾“å‡º
